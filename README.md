# VINE-K8趋势策略

基于Pine Script VINE-K8趋势策略转换的Python版本，适配青龙面板使用，支持多账户操作。

## 策略逻辑

### 核心逻辑
1. **K线分析**：使用K0（前一根K线）和K1（前两根K线）共同决策开仓方向
2. **方向一致性**：只有当K0和K1同方向时才开仓
3. **振幅过滤**：K0实体振幅在0.9%-3.5%之间
4. **总振幅限制**：K1~K5总振幅不超过2%
5. **趋势过滤**：使用EMA21、EMA60、EMA144判断趋势方向

### 交易条件
- **做多条件**：K0多头 + K1多头 + 多头趋势（EMA21 > EMA60 > EMA144）
- **做空条件**：K0空头 + K1空头 + 空头趋势（EMA21 < EMA60 < EMA144）

## 环境变量配置

在青龙面板的环境变量中添加以下配置：

### 新格式（推荐）
```bash
# 账户1配置
OKX_ACCOUNT_NAME=Account1-Will
OKX_API_KEY=faba2125-c26f-469a-85d3-e38e36e96afe
OKX_SECRET_KEY=449FC89C5662B7BE860039FC34D16C7E
OKX_PASSPHRASE=Willpan001!
OKX_FLAG=0

# 账户2配置（可选）
OKX_ACCOUNT_NAME1=Account2-Curry
OKX_API_KEY1=0faab1f0-f4ac-4b65-8fab-b09dd3edf6b5
OKX_SECRET_KEY1=8D0F9C86A7F5B6CE7123201200D34087
OKX_PASSPHRASE1=dxlzzDXLZZ33!
OKX_FLAG1=0

# 通知配置
BARK_API_KEY=oZaeqGLJzRLSxW7dJqeACn
BARK_GROUP=青龙交易通知PROD
```

### 旧格式（兼容）
```bash
# OKX账户1配置
OKX1_ACCOUNT_NAME=Account1-Will
OKX1_API_KEY=faba2125-c26f-469a-85d3-e38e36e96afe
OKX1_SECRET_KEY=449FC89C5662B7BE860039FC34D16C7E
OKX1_PASSPHRASE=Willpan001!
OKX1_FLAG=0

# OKX账户2配置（可选）
OKX2_ACCOUNT_NAME=Account2-Curry
OKX2_API_KEY=0faab1f0-f4ac-4b65-8fab-b09dd3edf6b5
OKX2_SECRET_KEY=8D0F9C86A7F5B6CE7123201200D34087
OKX2_PASSPHRASE=dxlzzDXLZZ33!
OKX2_FLAG=0

# 通知配置
BARK_API_KEY=oZaeqGLJzRLSxW7dJqeACn
BARK_GROUP=青龙交易通知PROD
```

## 策略参数

### 交易参数
- **交易标的**：VINE-USDT-SWAP
- **K线周期**：5分钟
- **杠杆倍数**：20倍
- **保证金**：5 USDT

### 风控参数
- **止盈**：2%
- **止损**：1.5%

### 信号过滤参数
- **K0最小实体振幅**：0.9%
- **K0最大实体振幅**：3.5%
- **K1~K5总振幅上限**：2%

### EMA趋势过滤
- **EMA21周期**：21
- **EMA60周期**：60
- **EMA144周期**：144
- **趋势过滤**：启用

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 直接运行
```bash
python VINE-K8趋势策略.py
```

### 2. 青龙面板定时任务
在青龙面板中添加定时任务：
- **名称**：VINE-K8趋势策略
- **命令**：python3 /path/to/VINE-K8趋势策略.py
- **定时规则**：*/5 * * * * （每5分钟执行一次）

## 执行流程

### 1. 获取K线数据
- 使用第一个账户获取K线数据（所有账户数据相同，可复用）
- 获取最新合约收盘价格

### 2. 逻辑判断
- 使用前一根K线进行判断（避免未收盘K线的影响）
- 分析K0和K1的方向一致性
- 检查振幅和趋势条件

### 3. 委托管理
- 检查每个账户的未成交委托
- 如果委托已超过止盈价格，自动撤销
- 撤销成功后继续执行开仓逻辑

### 4. 开仓操作
- 根据最新价格计算下单数量
- 对每个账户执行开仓操作
- 设置止盈止损价格

### 5. 通知发送
- 成功下单：发送包含完整交易信息的Bark通知
- 下单失败：发送包含错误信息的Bark通知

## Bark通知格式

### 成功下单通知
```
标题: VINE-K8趋势策略信号开仓

账户: [账户名]
交易标的: VINE-USDT-SWAP
信号类型: [做多/做空]
入场价格: [entry_price]（保留4位小数）
委托数量: [size]（保留2位小数）
保证金: 5 USDT
止盈价格: [take_profit_price]（保留4位小数）
止损价格: [stop_loss_price]（保留4位小数）
客户订单ID: [clOrdId]
时间: [当前上海时间]
```

### 下单失败通知
```
标题: VINE-K8趋势策略信号开仓

账户: [账户名]
交易标的: VINE-USDT-SWAP
信号类型: [做多/做空]
入场价格: [entry_price]（保留4位小数）
委托数量: [size]（保留2位小数）
保证金: 5 USDT
时间: [当前上海时间]

⚠️ 下单失败 ⚠️
错误: [OKX返回的详细错误提示]
服务器响应代码: [code]
服务器响应消息: [msg]
```

## 策略特点

### 优势
1. **严格的方向过滤**：需要K0和K1同方向才开仓
2. **趋势跟随**：只在明确趋势方向下开仓
3. **振幅控制**：避免过大或过小的K线振幅
4. **多账户支持**：支持同时操作多个账户
5. **智能委托管理**：自动撤销已超过止盈价格的委托
6. **实时通知**：交易信号通过Bark推送通知
7. **详细日志**：每个步骤都有详细的日志记录

### 风险提示
1. **市场风险**：加密货币市场波动较大，存在亏损风险
2. **技术风险**：网络延迟、API限制等可能影响策略执行
3. **参数风险**：策略参数需要根据市场情况调整

## 日志输出

策略运行时会输出详细的日志信息：
- 账户配置信息
- K线数据获取状态
- K0和K1的方向判断
- 方向一致性检查
- K线振幅分析
- 趋势判断结果
- 委托检查和撤销操作
- 下单数量计算
- 交易执行情况
- 通知发送状态

## 注意事项

1. **资金管理**：请根据自身资金情况调整保证金设置
2. **风险控制**：策略已包含止盈止损机制
3. **市场监控**：定期检查策略运行状态
4. **参数优化**：根据回测结果调整策略参数
5. **多账户管理**：确保所有账户都有足够的保证金

## 免责声明

本策略仅供学习和研究使用，不构成投资建议。使用本策略进行实际交易的风险由用户自行承担。